<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="color-scheme" content="light">
  <title>Pause Meals – TiffinTrack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/professional.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body class="app">

<!-- NAVBAR -->
<nav class="navbar">
  <div class="nav-container">
    <a href="{{ url_for('customer_dashboard') }}" class="logo">
      <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="TiffinTrack Logo" class="logo-image">
    </a>
    <div class="nav-actions">
      <a href="{{ url_for('customer_dashboard') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        Dashboard
      </a>
      <a href="{{ url_for('logout') }}" class="btn btn-secondary">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </a>
    </div>
  </div>
</nav>

<!-- FLASH MESSAGES -->
<div class="flash-messages">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash-message flash-{{ category }}">
          <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }}"></i>
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<div class="dashboard" style="max-width: 900px;">

  <div class="page-header" style="margin-bottom: 32px;">
    <div class="page-title">
      <h1>
        <i class="fas fa-calendar-times" style="margin-right: 12px; color: var(--primary);"></i>
        Pause Your Meals
      </h1>
      <p style="max-width: 520px; color: var(--text-secondary);">
        Quickly skip upcoming delivery days when you are travelling or unavailable. 
        You stay in full control of your schedule and billing.
      </p>
    </div>
    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 6px;">
      <span style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-secondary);">
        Today
      </span>
      <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 999px; background: var(--surface); border: 1px solid var(--border-light); font-size: 13px;">
        <i class="fas fa-clock" style="color: var(--primary);"></i>
        <span>Cutoff: <strong>8:00 AM</strong> for same‑day pauses</span>
      </div>
      <span style="font-size: 12px; color: var(--text-muted);">
        Paused days scheduled: <strong>{{ paused_dates|length }}</strong>
      </span>
    </div>
  </div>

  <!-- CUTOFF + SUMMARY -->
  <div class="activity-card" style="margin-bottom: 32px;">
    <div style="display: grid; grid-template-columns: minmax(0, 2fr) minmax(0, 3fr); gap: 24px; align-items: stretch;">
      <!-- Cutoff -->
      <div style="border-right: 1px solid var(--border-light); padding-right: 16px;">
        <div style="display: flex; align-items: center; gap: 16px;">
          <div style="width: 48px; height: 48px; background: var(--warning-light); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-clock" style="color: var(--warning); font-size: 20px;"></i>
          </div>
          <div>
            <h3 style="margin-bottom: 4px; color: var(--warning);">Important: Daily Cutoff Time</h3>
            <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">
              You can pause meals until <strong>8:00 AM</strong> on the delivery date. After this time, you’ll still be charged for that day’s meal.
            </p>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 160px; padding: 12px 14px; border-radius: 12px; background: var(--surface-elevated, var(--surface)); border: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between;">
            <div>
              <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin-bottom: 4px;">
                Paused days
              </div>
              <div style="font-size: 20px; font-weight: 700;">{{ paused_dates|length }}</div>
            </div>
            <i class="fas fa-calendar-minus" style="color: var(--primary); opacity: 0.9;"></i>
          </div>
          <div style="flex: 1; min-width: 160px; padding: 12px 14px; border-radius: 12px; background: var(--success-light); border: 1px solid var(--success); display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-money-bill-wave" style="color: var(--success);"></i>
            <p style="margin: 0; font-size: 13px; color: var(--success-dark);">
              Paused days are <strong>automatically excluded</strong> from your monthly bill.
            </p>
          </div>
        </div>
        <p style="font-size: 12px; color: var(--text-secondary); margin: 0;">
          Tip: Schedule all known holidays and travel dates in advance to avoid last‑minute changes.
        </p>
      </div>
    </div>
  </div>

  <!-- PAUSE FORM -->
  <div class="card" style="margin-bottom: 32px;">
    <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 20px;">
      <div>
        <h3 style="margin: 0 0 4px 0;">
          <i class="fas fa-plus-circle" style="margin-right: 8px; color: var(--primary);"></i>
          Pause a Meal
        </h3>
        <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">
          Select a date to skip your meal delivery. You can always remove a pause later (before 8:00 AM).
        </p>
      </div>
      <span style="font-size: 12px; color: var(--text-muted); white-space: nowrap;">
        Earliest date allowed is today
      </span>
    </div>

    <form method="POST" action="/pause/save" id="pauseForm">
      <div class="pause-form-grid">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary);">
            <i class="fas fa-calendar-alt" style="margin-right: 8px; color: var(--primary);"></i>
            Select Date
          </label>
          <input 
            type="date" 
            name="pause_date" 
            class="input" 
            required
            min="{{ (date.today() + timedelta(days=0)).strftime('%Y-%m-%d') }}"
            id="pauseDateInput"
          >
          <p style="margin: 6px 0 0 0; font-size: 12px; color: var(--text-secondary);">
            You can only choose today or future dates.
          </p>
        </div>
        
        <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 8px;">
          <button type="submit" class="btn btn-primary" id="pauseBtn" style="min-width: 180px;">
            <i class="fas fa-pause-circle"></i>
            Pause Meal
          </button>
          <span style="font-size: 12px; color: var(--text-muted);">
            Your plan remains active on all other days.
          </span>
        </div>
      </div>
    </form>
  </div>

  <!-- PAUSED DATES -->
  <div class="activity-card">
    <h3><i class="fas fa-list" style="margin-right: 8px; color: var(--secondary);"></i>Your Paused Dates</h3>
    
    {% if paused_dates %}
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; margin-top: 20px;">
        {% for date_str in paused_dates %}
          {% set pause_date = date_str | strptime('%Y-%m-%d') %}
          <div class="paused-date-card">
            <div class="paused-date-icon">
              <i class="fas fa-calendar-times"></i>
            </div>
            <div class="paused-date-info">
              <div class="paused-date-day">{{ pause_date.strftime('%d') }}</div>
              <div class="paused-date-month">{{ pause_date.strftime('%b %Y') }}</div>
              <div class="paused-date-weekday">{{ pause_date.strftime('%A') }}</div>
            </div>
            <button onclick="removePause('{{ date_str }}')" class="remove-pause-btn" title="Remove pause">
              <i class="fas fa-times"></i>
            </button>
          </div>
        {% endfor %}
      </div>
      
      <div style="margin-top: 24px; padding: 16px; background: var(--success-light); border-radius: 12px; border-left: 4px solid var(--success);">
        <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--success);">
          <i class="fas fa-info-circle"></i> Billing Impact
        </h4>
        <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
          You have <strong>{{ paused_dates|length }} paused day{{ 's' if paused_dates|length != 1 else '' }}</strong> this month. 
          These will be automatically excluded from your monthly bill.
        </p>
      </div>
    {% else %}
      <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
        <i class="fas fa-calendar-check" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i>
        <h4 style="margin-bottom: 8px;">No Paused Dates</h4>
        <p style="font-size: 14px; margin: 0;">You haven't paused any meals yet. Use the form above to pause meals when you're away.</p>
      </div>
    {% endif %}
  </div>

  <!-- HELPFUL TIPS -->
  <div class="activity-card" style="margin-top: 32px;">
    <h3><i class="fas fa-lightbulb" style="margin-right: 8px; color: var(--accent);"></i>Tips for Pausing Meals</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 16px;">
      
      <div style="display: flex; align-items: start; gap: 12px;">
        <div style="width: 32px; height: 32px; background: var(--primary-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <i class="fas fa-clock" style="color: var(--primary); font-size: 14px;"></i>
        </div>
        <div>
          <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 4px;">Plan Ahead</h4>
          <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
            Pause meals in advance for vacations or business trips to avoid unnecessary charges.
          </p>
        </div>
      </div>
      
      <div style="display: flex; align-items: start; gap: 12px;">
        <div style="width: 32px; height: 32px; background: var(--success-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <i class="fas fa-money-bill-wave" style="color: var(--success); font-size: 14px;"></i>
        </div>
        <div>
          <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 4px;">Save Money</h4>
          <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
            Paused days are automatically deducted from your monthly bill - no manual adjustments needed.
          </p>
        </div>
      </div>
      
      <div style="display: flex; align-items: start; gap: 12px;">
        <div style="width: 32px; height: 32px; background: var(--warning-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <i class="fas fa-undo" style="color: var(--warning); font-size: 14px;"></i>
        </div>
        <div>
          <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 4px;">Flexible Changes</h4>
          <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
            You can remove paused dates if your plans change, as long as it's before the cutoff time.
          </p>
        </div>
      </div>
      
      <div style="display: flex; align-items: start; gap: 12px;">
        <div style="width: 32px; height: 32px; background: var(--info-light); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <i class="fas fa-mobile-alt" style="color: var(--info); font-size: 14px;"></i>
        </div>
        <div>
          <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 4px;">Best viewed on latest browser</h4>
          <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">
            For the smoothest experience, use the latest version of Chrome, Safari, or Edge on your phone or laptop.
          </p>
        </div>
      </div>
      
    </div>
  </div>

</div>

<script>
  // Form submission with loading state
  document.getElementById('pauseForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('pauseBtn');
    btn.innerHTML = '<div class="loading"></div> Pausing...';
    btn.disabled = true;
  });

  // Auto-hide flash messages
  setTimeout(() => {
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(msg => {
      msg.style.animation = 'slideOut 0.3s ease-out forwards';
      setTimeout(() => msg.remove(), 300);
    });
  }, 5000);

  // Remove pause function with API call
  async function removePause(dateStr) {
    if (!confirm('Are you sure you want to remove this paused date?')) {
      return;
    }
    
    try {
      const response = await fetch('/pause/remove', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ pause_date: dateStr })
      });
      
      const data = await response.json();
      
      if (response.ok && data.success) {
        // Show success message
        showFlashMessage('Pause removed successfully', 'success');
        
        // Reload page after short delay
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      } else {
        showFlashMessage(data.error || 'Failed to remove pause', 'error');
      }
    } catch (error) {
      console.error('Error removing pause:', error);
      showFlashMessage('Failed to remove pause. Please try again.', 'error');
    }
  }
  
  // Show flash message dynamically
  function showFlashMessage(message, category) {
    const flashContainer = document.querySelector('.flash-messages');
    const flashDiv = document.createElement('div');
    flashDiv.className = `flash-message flash-${category}`;
    flashDiv.innerHTML = `
      <i class="fas fa-${category === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
      ${message}
    `;
    flashContainer.appendChild(flashDiv);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
      flashDiv.style.animation = 'slideOut 0.3s ease-out forwards';
      setTimeout(() => flashDiv.remove(), 300);
    }, 5000);
  }

  // Set minimum date to today
  document.getElementById('pauseDateInput').min = new Date().toISOString().split('T')[0];
</script>

<style>
@keyframes slideOut {
  to {
    opacity: 0;
    transform: translateX(100%);
  }
}

.paused-date-card {
  background: var(--surface);
  border: 2px solid var(--warning-light);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  position: relative;
}

.paused-date-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: var(--warning);
}

.paused-date-icon {
  width: 40px;
  height: 40px;
  background: var(--warning-light);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--warning);
  font-size: 18px;
}

.paused-date-info {
  flex: 1;
}

.paused-date-day {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1;
}

.paused-date-month {
  font-size: 0.8rem;
  color: var(--text-secondary);
  font-weight: 500;
  margin-bottom: 2px;
}

.paused-date-weekday {
  font-size: 0.7rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.remove-pause-btn {
  width: 28px;
  height: 28px;
  background: var(--danger-light);
  border: none;
  border-radius: 8px;
  color: var(--danger);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  transition: all 0.3s ease;
  opacity: 0.7;
}

.remove-pause-btn:hover {
  background: var(--danger);
  color: white;
  opacity: 1;
  transform: scale(1.1);
}

.paused-date-card:hover .remove-pause-btn {
  opacity: 1;
}

.pause-form-grid {
  display: grid;
  grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
  gap: 20px;
  align-items: flex-end;
}

@media (max-width: 768px) {
  .pause-form-grid {
    grid-template-columns: 1fr;
  }
}
</style>

</body>
</html>
