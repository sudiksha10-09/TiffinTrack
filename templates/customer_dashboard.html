<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Dashboard ‚Äì TiffinTrack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body class="app">

<!-- NAVBAR -->
<nav class="navbar">
  <div class="nav-container">
    <div class="logo">üç± TiffinTrack</div>

    <div class="nav-actions">
      <span style="margin-right: 16px; color: var(--text-secondary); font-weight: 500;">
        <i class="fas fa-user-circle" style="margin-right: 8px; color: var(--primary);"></i>
        {{ session.get('user_name') }}
      </span>
      <a href="/logout" class="btn-secondary">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </a>
    </div>
  </div>
</nav>

<!-- FLASH MESSAGES -->
<div class="flash-messages">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash-message flash-{{ category }}">
          <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }}"></i>
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- DASHBOARD -->
<div class="dashboard">

  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
    <div>
      <h1>Welcome back, {{ session.get('user_name').split()[0] }}!</h1>
      <p style="color: var(--text-secondary); font-size: 1.1rem;">
        Here's your tiffin service overview for today
      </p>
    </div>
    
    {% if paused_today %}
      <div class="badge" style="background: var(--warning-light); color: var(--warning); animation: none;">
        <i class="fas fa-pause-circle"></i> Paused Today
      </div>
    {% else %}
      <div class="badge" style="background: var(--success-light); color: var(--success); animation: none;">
        <i class="fas fa-check-circle"></i> Active Today
      </div>
    {% endif %}
  </div>

  <!-- QUICK STATS -->
  <div class="kpi-grid">

    <div class="kpi-card">
      <div class="kpi-icon" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);">
        <i class="fas fa-rupee-sign"></i>
      </div>
      <div class="kpi-info">
        <h3>This Month's Bill</h3>
        <p>‚Çπ {{ estimated_bill }}</p>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-icon" style="background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);">
        <i class="fas fa-calendar-check"></i>
      </div>
      <div class="kpi-info">
        <h3>Active Plans</h3>
        <p>{{ active_plans|length }}</p>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-icon" style="background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);">
        <i class="fas fa-pause-circle"></i>
      </div>
      <div class="kpi-info">
        <h3>Paused This Month</h3>
        <p>{{ paused_this_month }} days</p>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-icon" style="background: linear-gradient(135deg, var(--success) 0%, #059669 100%);">
        <i class="fas fa-utensils"></i>
      </div>
      <div class="kpi-info">
        <h3>Billable Days</h3>
        <p>{{ total_days - paused_this_month }}</p>
      </div>
    </div>

  </div>

  <!-- QUICK ACTIONS -->
  <div class="quick-actions">
    
    <div class="action-card" onclick="location.href='/plans'">
      <div class="action-icon">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <div class="action-info">
        <h4>Manage Plans</h4>
        <p>Select and customize your meal plans and schedules</p>
      </div>
    </div>

    <div class="action-card" onclick="location.href='/pause'">
      <div class="action-icon">
        <i class="fas fa-calendar-times"></i>
      </div>
      <div class="action-info">
        <h4>Pause Meals</h4>
        <p>Skip meals for specific dates when you're away</p>
      </div>
    </div>

    <div class="action-card" onclick="location.href='/billing'">
      <div class="action-icon">
        <i class="fas fa-file-invoice-dollar"></i>
      </div>
      <div class="action-info">
        <h4>View Billing</h4>
        <p>Check your monthly bills and payment history</p>
      </div>
    </div>

    <div class="action-card" onclick="showProfileModal()">
      <div class="action-icon">
        <i class="fas fa-user-cog"></i>
      </div>
      <div class="action-info">
        <h4>Profile Settings</h4>
        <p>Update your personal details and preferences</p>
      </div>
    </div>

  </div>

  <!-- ACTIVITY SECTION -->
  <div class="activity-grid">

    <!-- Current Plans -->
    <div class="activity-card">
      <h3><i class="fas fa-utensils" style="margin-right: 8px; color: var(--primary);"></i>Active Plans</h3>
      
      {% if active_plans %}
        {% for cp, plan in active_plans %}
        <div class="activity-item">
          <div class="activity-dot" style="background: var(--primary);"></div>
          <div class="activity-text">
            <strong>{{ plan.name }}</strong> - ‚Çπ{{ plan.daily_rate }}/day
            <br>
            <small style="color: var(--text-secondary);">
              {{ cp.start_date.strftime('%b %d') }} to {{ cp.end_date.strftime('%b %d, %Y') }}
            </small>
          </div>
          <div class="activity-time">
            <span class="badge-pill badge-active">Active</span>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
          <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 12px; opacity: 0.5;"></i>
          <p>No active plans</p>
          <a href="/plans" class="btn-outline" style="margin-top: 12px; font-size: 12px; padding: 8px 16px;">
            Select Plans
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Recent Activity -->
    <div class="activity-card">
      <h3><i class="fas fa-history" style="margin-right: 8px; color: var(--secondary);"></i>Recent Activity</h3>
      
      {% if recent_pauses %}
        {% for pause in recent_pauses %}
        <div class="activity-item">
          <div class="activity-dot" style="background: var(--warning);"></div>
          <div class="activity-text">
            Paused meal for {{ pause.pause_date.strftime('%B %d, %Y') }}
          </div>
          <div class="activity-time">
            {{ pause.created_at.strftime('%b %d') }}
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
          <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 12px; opacity: 0.5;"></i>
          <p>No recent activity</p>
        </div>
      {% endif %}
    </div>

  </div>

  <!-- HELPFUL TIPS -->
  <div class="activity-card">
    <h3><i class="fas fa-lightbulb" style="margin-right: 8px; color: var(--accent);"></i>Tips & Reminders</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 16px;">
      
      <div style="padding: 16px; background: var(--primary-light); border-radius: 12px; border-left: 4px solid var(--primary);">
        <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--primary-dark);">
          <i class="fas fa-clock"></i> Pause Cutoff
        </h4>
        <p style="font-size: 0.8rem; color: var(--text-secondary);">
          Remember to pause meals before 8:00 AM to avoid charges for that day.
        </p>
      </div>
      
      <div style="padding: 16px; background: var(--success-light); border-radius: 12px; border-left: 4px solid var(--success);">
        <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--success);">
          <i class="fas fa-money-bill-wave"></i> Save Money
        </h4>
        <p style="font-size: 0.8rem; color: var(--text-secondary);">
          Paused days are automatically excluded from your monthly bill.
        </p>
      </div>
      
      <div style="padding: 16px; background: var(--warning-light); border-radius: 12px; border-left: 4px solid var(--warning);">
        <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--warning);">
          <i class="fas fa-phone"></i> Need Help?
        </h4>
        <p style="font-size: 0.8rem; color: var(--text-secondary);">
          Contact support at +91 90000 00000 for any assistance.
        </p>
      </div>
      
    </div>
  </div>

</div>

<!-- Profile Modal (placeholder) -->
<div id="profileModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Profile Settings</h3>
      <button onclick="hideProfileModal()" class="modal-close">&times;</button>
    </div>
    <div style="padding: 20px; text-align: center; color: var(--text-secondary);">
      <i class="fas fa-cog" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i>
      <p>Profile management feature coming soon!</p>
      <button onclick="hideProfileModal()" class="btn-outline" style="margin-top: 16px;">Close</button>
    </div>
  </div>
</div>

<script>
  function showProfileModal() {
    document.getElementById('profileModal').style.display = 'flex';
  }
  
  function hideProfileModal() {
    document.getElementById('profileModal').style.display = 'none';
  }

  // Auto-hide flash messages
  setTimeout(() => {
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(msg => {
      msg.style.animation = 'slideOut 0.3s ease-out forwards';
      setTimeout(() => msg.remove(), 300);
    });
  }, 5000);
</script>

<style>
@keyframes slideOut {
  to {
    opacity: 0;
    transform: translateX(100%);
  }
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid var(--border);
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary);
  transition: color 0.3s ease;
}

.modal-close:hover {
  color: var(--danger);
}
</style>

</body>
</html>
